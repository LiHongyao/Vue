# @Vue 模板编译原理

vue中AST主要运用在 **模板编译** 过程。我们先来看看 vue 模板编译的整体流程。

Vue2.x：`template(模板)` → `parse(模板基础编译)` → `optimize(优化AST)` → `generate(生成js字符串)` → `Render函数`

Vue3.x：`Template(模板)`  → `Parse(解析)` → `Transform(转换)` → `Generate(生成)` → `Render函数`

vue中的模板编译主要分为三个步骤：

1）解析器阶段：将 template 里面的代码解析成AST抽象语法树;

2）优化器阶段：将AST抽象语法树静态标签打上`tag`，防止重复渲染(优化了 `diff` 算法)；

3）代码生成器阶段：优化后的AST抽象语法树通过 `generate` 函数生成 `render` 函数字符串；

我们来看看vue源码的整体实现过程：

> 源码位置：`vue/dist/vue.global.js` → `rows：14975`

```javascript
function baseCompile(template, options = {}) {
  // -- baseParse：解析生成AST
  const ast = isString(template) ? baseParse(template, options) : template;
  // -- 对AST进行转换
  transform(
    ast,
    extend({}, options, { ··· })
  );
  // -- 生成可执行函数
  return generate(
    ast,
    extend({}, options, {
      prefixIdentifiers,
    })
  );
}
```

> 提示：这里只是简单列举出了 `vue3 - baseCompile` 方法中的核心代码，如果大家有兴趣，可以自行去阅读源码。

解析器要实现的功能就是将模板解析成 AST，我们这里主要来分析一下代码解析阶段，这里主要运用的是 `baseParse()` 这个函数，事实上，解析器内部也分为好几个解析器，比如 `HTML解析器`**、**`文本解析器` 以及 `过滤解析器`，其中最主要的就是HTML解析器。HTML解析器的作用就是解析HTML，它在解析HTML的过程中会不断触发各种钩子函数，我们来看看代码实现：

> 源码位置：`vue/dist/vue.global.js` → `rows：11713`

